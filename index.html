<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Eiffel RemRem Publish Service by evasiba-ericsson</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Eiffel RemRem Publish Service</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/evasiba-ericsson/eiffel-remrem-publish" class="btn">View on GitHub</a>
      <a href="https://github.com/evasiba-ericsson/eiffel-remrem-publish/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/evasiba-ericsson/eiffel-remrem-publish/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p>REMReM (REST Mailbox for Registered Messages) is a set of tools that can be used to generate validated Eiffel messages and publish them on a RabbitMQ message bus. They can be run as micro services or as stand-alone CLI versions. For more details on the micro services and the REMReM design, see <a href="https://github.com/Ericsson/eiffel-remrem">https://github.com/Ericsson/eiffel-remrem</a></p>

<h1>
<a id="remrem-publish" class="anchor" href="#remrem-publish" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RemRem Publish</h1>

<hr>

<h2>
<a id="compatibility" class="anchor" href="#compatibility" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Compatibility</h2>

<ul>
<li>JDK 8</li>
<li>Tomcat 7</li>
</ul>

<hr>

<h2>
<a id="how-to-install" class="anchor" href="#how-to-install" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How to Install?</h2>

<p>Binary is relased via <a href="https://jitpack.io/#Ericsson/eiffel-remrem-publish/">jitPack</a></p>

<p>RemRem Publish in this repository is licensed under the <a href="https://raw.githubusercontent.com/ericsson/eiffel-remrem-publish/master/LICENSE">Apache License 2.0</a>.</p>

<hr>

<h2>
<a id="usage-cli-command-line-interface" class="anchor" href="#usage-cli-command-line-interface" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage CLI (Command Line Interface)</h2>

<p>$ java -jar publish.war -h</p>

<p>You passed help flag.</p>

<p>usage: java -jar</p>

<p>-en,--exchange_name    exchange name, default is eiffel.poc</p>

<p>-f,--content_file      event content file, mandatory</p>

<p>-h,--help                   show help.</p>

<p>-json,--json_content    event content in json string. The value can
                              also be a dash(-) and the json will be read
                              from the output of other programs if piped.</p>

<p>-mb,--message_bus      host of message bus to use, default is
                             127.0.0.1</p>

<p>-np,--non_persistent        remove persistence from message sending</p>

<p>-port,--port            port to connect to message bus</p>

<p>-rk,--routing_key      routing key, mandatory</p>

<p>Input can be from file or by providing the json string as an argument. If several messages need to be send they must be provided as a json array (several json elements separated by comma and surrounded by square brackets) </p>

<p><strong>Publish on a given host, a given exchange and given routing key:</strong>                    </p>

<pre><code> $ java -jar publish.war -f publishMessages.json -en amq.direct -mb 127.0.0.1 -rk test
</code></pre>

<p><strong>If you want to have the message non persistent add np flag:</strong></p>

<pre><code> $ java -jar publish.war -f publishMessages.json -en amq.direct -mb 127.0.0.1 -rk test -np
</code></pre>

<p><strong>It is now possible to pipe json content if it results from another application like remrem generate for example. 
What is needed is to inform publish with option json - that json content needs to be read from standard input</strong></p>

<pre><code> $ java -jar remrem-generate-0.5.7.war -f eiffelartifactpublished.json -t eiffelartifactpublished | java -jar remrem-publish-0.1.6.war -json - -rk test
</code></pre>

<h2>
<a id="usage-service" class="anchor" href="#usage-service" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage service</h2>

<p>RemRem Publish microservice allows for sending messages to a topic-based exchange on a RabbitMQ Server. It has an endPoint that must be called using a relative link <code>producer/msg</code>.</p>

<h3>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration</h3>

<p>Two parameters need to be provided to start the service:</p>

<ul>
<li>rabbitmq.host (String)</li>
<li>rabbitmq.exchange.name (String)</li>
</ul>

<p>An <a href="https://www.rabbitmq.com/tutorials/tutorial-three-java.html">exchange point</a> must exist before you start the service.</p>

<p>For <strong>stand-alone</strong> deployment, the library can be utilized like this:</p>

<pre><code>$ java -Drabbitmq.host=localhost -Drabbitmq.exchange.name=EXCHANGE_NAME -jar eiffel-remrem*
</code></pre>

<p>Binary comes in War format which allows easy deployment in application servers such as Tomcat. In that case, these parameters must be provided to java process running tomcat. You can also provide them in the <code>WEB-INF/classes/application.yml</code> file.</p>

<h3>
<a id="rest-methods" class="anchor" href="#rest-methods" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>REST methods</h3>

<p>The service works on the relative link <code>producer/msg</code> and supports POST requests.</p>

<p>You have to specify a <a href="https://www.rabbitmq.com/tutorials/tutorial-four-java.html">routing key</a> using <code>rk</code> URL parameter.</p>

<p>The request's body must contain a <strong>JSON Array</strong> with the messages.</p>

<hr>

<h2>
<a id="testing" class="anchor" href="#testing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Testing</h2>

<p>You can use command-line tools like <a href="https://en.wikipedia.org/wiki/CURL">curl</a> or some plugin for your favorite browser. For example:</p>

<ul>
<li>
<a href="https://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop">Postman</a> for Chromium-based browsers</li>
<li>
<a href="https://addons.mozilla.org/en-US/firefox/addon/httprequester/">HttpRequester</a> for Firefox</li>
</ul>

<h3>
<a id="a-few-examples-with-curl" class="anchor" href="#a-few-examples-with-curl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>A few examples with <code>curl</code>:</h3>

<p><strong>One message:</strong></p>

<pre><code>$ curl -H "Content-Type: application/json" -X POST -d '["test"]' http://localhost:8080/producer/msg?rk=test

["succeed"]
</code></pre>

<p><strong>Two messages/objects:</strong></p>

<pre><code>$ curl -H "Content-Type: application/json" -X POST -d '[{"key":"value1"}, {"key":"value2"}]' http://localhost:8080/producer/msg?rk=test

["succeed","succeed"]
</code></pre>

<p><strong>Reading data from a file:</strong></p>

<pre><code>$ echo '["msg1", "msg2", "msg3"]' &gt; test.data
$ curl -H "Content-Type: application/json" -X POST --data-binary "@test.data" http://localhost:8080/producer/msg?rk=test

["succeed","succeed","succeed"]
</code></pre>

<p><strong>Malformed input:</strong></p>

<pre><code>$ curl -H "Content-Type: application/json" -X POST -d 'SOMETHING' http://localhost:8080/producer/msg?rk=test

{"timestamp":"May 31, 2016 9:14:17 AM","status":400,"error":"Bad Request","exception":"org.springframework.http.converter.HttpMessageNotReadableException","message":"Could not read JSON: Expected a com.google.gson.JsonArray but was com.google.gson.JsonPrimitive; nested exception is com.google.gson.JsonSyntaxException: Expected a com.google.gson.JsonArray but was com.google.gson.JsonPrimitive","path":"/producer/msg"}
</code></pre>

<p>You can open the RabbitMQ's management console and find these messages in a queue.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/evasiba-ericsson/eiffel-remrem-publish">Eiffel RemRem Publish Service</a> is maintained by <a href="https://github.com/evasiba-ericsson">evasiba-ericsson</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
